<?xml version="1.0"?>
<!DOCTYPE workflow
[
	<!--
	PROGRAM
		Main workflow manager for cycling Global Forecast System

	AUTHOR:
		Rahul Mahajan
		rahul.mahajan@noaa.gov

	NOTES:
		This workflow was automatically generated at 2020-11-25 00:47:44.908277
	-->

	<!-- Experiment parameters such as name, starting, ending dates -->
	<!ENTITY PSLOT "gsdnoahcyc">
	<!ENTITY SDATE "202002080000">
	<!ENTITY EDATE "202002100000">

	<!-- Starting and ending dates for GFS cycle -->
	<!ENTITY SDATE_GFS    "202002090000">
	<!ENTITY EDATE_GFS    "202002100000">
	<!ENTITY INTERVAL_GFS "24:00:00">

	<!-- Run Envrionment -->
	<!ENTITY RUN_ENVIR "emc">

	<!-- Experiment and Rotation directory -->
	<!ENTITY EXPDIR "/scratch2/BMC/gsd-fv3-dev/Judy.K.Henderson/test/emc_feature_lgan/FV3GFSwfm/gsdnoahcyc">
	<!ENTITY ROTDIR "/scratch2/BMC/gsd-fv3-dev/Judy.K.Henderson/test/emc_feature_lgan/FV3GFSrun/gsdnoahcyc">

	<!-- Directories for driving the workflow -->
	<!ENTITY HOMEgfs  "/scratch2/BMC/gsd-fv3-dev/Judy.K.Henderson/test/emc_feature_lgan">
	<!ENTITY JOBS_DIR "/scratch2/BMC/gsd-fv3-dev/Judy.K.Henderson/test/emc_feature_lgan/jobs/rocoto">
	<!ENTITY DMPDIR   "/scratch1/NCEPDEV/global/glopara/dump">

	<!-- Machine related entities -->
	<!ENTITY ACCOUNT    "gsd-fv3-dev">
	<!ENTITY QUEUE      "batch">
	<!ENTITY QUEUE_SERVICE "service">
	<!ENTITY PARTITION_SERVICE "service">
	<!ENTITY SCHEDULER  "slurm">

	<!-- Toggle HPSS archiving -->
	<!ENTITY ARCHIVE_TO_HPSS "YES">

	<!-- ROCOTO parameters that control workflow -->
	<!ENTITY CYCLETHROTTLE "3">
	<!ENTITY TASKTHROTTLE  "25">
	<!ENTITY MAXTRIES      "2">

	<!ENTITY QUEUE_PREP_GDAS     "&QUEUE;">
	<!ENTITY WALLTIME_PREP_GDAS  "00:45:00">
	<!ENTITY RESOURCES_PREP_GDAS "<nodes>2:ppn=2:tpp=1</nodes>">
	<!ENTITY NATIVE_PREP_GDAS    "--export=NONE">

	<!ENTITY QUEUE_ANAL_GDAS     "&QUEUE;">
	<!ENTITY WALLTIME_ANAL_GDAS  "01:00:00">
	<!ENTITY RESOURCES_ANAL_GDAS "<nodes>125:ppn=8:tpp=5</nodes>">
	<!ENTITY NATIVE_ANAL_GDAS    "--export=NONE">

	<!ENTITY QUEUE_ANALCALC_GDAS     "&QUEUE;">
	<!ENTITY WALLTIME_ANALCALC_GDAS  "00:10:00">
	<!ENTITY RESOURCES_ANALCALC_GDAS "<nodes>4:ppn=40:tpp=1</nodes>">
	<!ENTITY NATIVE_ANALCALC_GDAS    "--export=NONE">

	<!ENTITY QUEUE_ANALDIAG_GDAS     "&QUEUE;">
	<!ENTITY WALLTIME_ANALDIAG_GDAS  "00:10:00">
	<!ENTITY RESOURCES_ANALDIAG_GDAS "<nodes>3:ppn=40:tpp=1</nodes>">
	<!ENTITY NATIVE_ANALDIAG_GDAS    "--export=NONE">

	<!ENTITY QUEUE_GLDAS_GDAS     "&QUEUE;">
	<!ENTITY WALLTIME_GLDAS_GDAS  "00:10:00">
	<!ENTITY RESOURCES_GLDAS_GDAS "<nodes>3:ppn=40:tpp=1</nodes>">
	<!ENTITY NATIVE_GLDAS_GDAS    "--export=NONE">

	<!ENTITY QUEUE_FCST_GDAS     "&QUEUE;">
	<!ENTITY WALLTIME_FCST_GDAS  "00:30:00">
	<!ENTITY RESOURCES_FCST_GDAS "<nodes>74:ppn=10:tpp=4</nodes>">
	<!ENTITY NATIVE_FCST_GDAS    "--export=NONE">

	<!ENTITY QUEUE_POST_GDAS     "&QUEUE;">
	<!ENTITY WALLTIME_POST_GDAS  "02:00:00">
	<!ENTITY RESOURCES_POST_GDAS "<nodes>8:ppn=12:tpp=1</nodes>">
	<!ENTITY NATIVE_POST_GDAS    "--export=NONE">

	<!ENTITY QUEUE_VRFY_GDAS     "&QUEUE;">
	<!ENTITY WALLTIME_VRFY_GDAS  "03:00:00">
	<!ENTITY RESOURCES_VRFY_GDAS "<nodes>3:ppn=1:tpp=1</nodes>">
	<!ENTITY MEMORY_VRFY_GDAS    "16384M">
	<!ENTITY NATIVE_VRFY_GDAS    "--export=NONE">

	<!ENTITY QUEUE_ARCH_GDAS     "&QUEUE;">
	<!ENTITY PARTITION_ARCH_GDAS "&PARTITION_SERVICE;">
	<!ENTITY WALLTIME_ARCH_GDAS  "06:00:00">
	<!ENTITY RESOURCES_ARCH_GDAS "<nodes>1:ppn=1:tpp=1</nodes>">
	<!ENTITY MEMORY_ARCH_GDAS    "2048M">
	<!ENTITY NATIVE_ARCH_GDAS    "--export=NONE">

	<!ENTITY QUEUE_EOBS_GDAS     "&QUEUE;">
	<!ENTITY WALLTIME_EOBS_GDAS  "00:15:00">
	<!ENTITY RESOURCES_EOBS_GDAS "<nodes>10:ppn=20:tpp=2</nodes>">
	<!ENTITY NATIVE_EOBS_GDAS    "--export=NONE">

	<!ENTITY QUEUE_EDIAG_GDAS     "&QUEUE;">
	<!ENTITY WALLTIME_EDIAG_GDAS  "00:06:00">
	<!ENTITY RESOURCES_EDIAG_GDAS "<nodes>2:ppn=40:tpp=1</nodes>">
	<!ENTITY NATIVE_EDIAG_GDAS    "--export=NONE">

	<!ENTITY QUEUE_EUPD_GDAS     "&QUEUE;">
	<!ENTITY WALLTIME_EUPD_GDAS  "00:30:00">
	<!ENTITY RESOURCES_EUPD_GDAS "<nodes>150:ppn=1:tpp=40</nodes>">
	<!ENTITY NATIVE_EUPD_GDAS    "--export=NONE">

	<!ENTITY QUEUE_ECHGRES_GDAS     "&QUEUE;">
	<!ENTITY WALLTIME_ECHGRES_GDAS  "00:10:00">
	<!ENTITY RESOURCES_ECHGRES_GDAS "<nodes>3:ppn=1:tpp=40</nodes>">
	<!ENTITY NATIVE_ECHGRES_GDAS    "--export=NONE">

	<!ENTITY QUEUE_ECEN_GDAS     "&QUEUE;">
	<!ENTITY WALLTIME_ECEN_GDAS  "00:10:00">
	<!ENTITY RESOURCES_ECEN_GDAS "<nodes>14:ppn=6:tpp=6</nodes>">
	<!ENTITY NATIVE_ECEN_GDAS    "--export=NONE">

	<!ENTITY QUEUE_ESFC_GDAS     "&QUEUE;">
	<!ENTITY WALLTIME_ESFC_GDAS  "00:06:00">
	<!ENTITY RESOURCES_ESFC_GDAS "<nodes>2:ppn=40:tpp=1</nodes>">
	<!ENTITY NATIVE_ESFC_GDAS    "--export=NONE">

	<!ENTITY QUEUE_EFCS_GDAS     "&QUEUE;">
	<!ENTITY WALLTIME_EFCS_GDAS  "01:00:00">
	<!ENTITY RESOURCES_EFCS_GDAS "<nodes>11:ppn=40:tpp=1</nodes>">
	<!ENTITY NATIVE_EFCS_GDAS    "--export=NONE">

	<!ENTITY QUEUE_EPOS_GDAS     "&QUEUE;">
	<!ENTITY WALLTIME_EPOS_GDAS  "00:15:00">
	<!ENTITY RESOURCES_EPOS_GDAS "<nodes>14:ppn=6:tpp=6</nodes>">
	<!ENTITY NATIVE_EPOS_GDAS    "--export=NONE">

	<!ENTITY QUEUE_EARC_GDAS     "&QUEUE;">
	<!ENTITY PARTITION_EARC_GDAS "&PARTITION_SERVICE;">
	<!ENTITY WALLTIME_EARC_GDAS  "06:00:00">
	<!ENTITY RESOURCES_EARC_GDAS "<nodes>1:ppn=1:tpp=1</nodes>">
	<!ENTITY MEMORY_EARC_GDAS    "2048M">
	<!ENTITY NATIVE_EARC_GDAS    "--export=NONE">

	<!ENTITY QUEUE_PREP_GFS     "&QUEUE;">
	<!ENTITY WALLTIME_PREP_GFS  "00:45:00">
	<!ENTITY RESOURCES_PREP_GFS "<nodes>2:ppn=2:tpp=1</nodes>">
	<!ENTITY NATIVE_PREP_GFS    "--export=NONE">

	<!ENTITY QUEUE_ANAL_GFS     "&QUEUE;">
	<!ENTITY WALLTIME_ANAL_GFS  "01:00:00">
	<!ENTITY RESOURCES_ANAL_GFS "<nodes>125:ppn=8:tpp=5</nodes>">
	<!ENTITY NATIVE_ANAL_GFS    "--export=NONE">

	<!ENTITY QUEUE_ANALCALC_GFS     "&QUEUE;">
	<!ENTITY WALLTIME_ANALCALC_GFS  "00:10:00">
	<!ENTITY RESOURCES_ANALCALC_GFS "<nodes>4:ppn=40:tpp=1</nodes>">
	<!ENTITY NATIVE_ANALCALC_GFS    "--export=NONE">

	<!ENTITY QUEUE_FCST_GFS     "&QUEUE;">
	<!ENTITY WALLTIME_FCST_GFS  "06:00:00">
	<!ENTITY RESOURCES_FCST_GFS "<nodes>122:ppn=10:tpp=4</nodes>">
	<!ENTITY NATIVE_FCST_GFS    "--export=NONE">

	<!ENTITY QUEUE_POST_GFS     "&QUEUE;">
	<!ENTITY WALLTIME_POST_GFS  "06:00:00">
	<!ENTITY RESOURCES_POST_GFS "<nodes>8:ppn=12:tpp=1</nodes>">
	<!ENTITY NATIVE_POST_GFS    "--export=NONE">

	<!ENTITY QUEUE_VRFY_GFS     "&QUEUE;">
	<!ENTITY WALLTIME_VRFY_GFS  "06:00:00">
	<!ENTITY RESOURCES_VRFY_GFS "<nodes>1:ppn=1:tpp=1</nodes>">
	<!ENTITY MEMORY_VRFY_GFS    "16384M">
	<!ENTITY NATIVE_VRFY_GFS    "--export=NONE">

	<!ENTITY QUEUE_ARCH_GFS     "&QUEUE;">
	<!ENTITY PARTITION_ARCH_GFS "&PARTITION_SERVICE;">
	<!ENTITY WALLTIME_ARCH_GFS  "06:00:00">
	<!ENTITY RESOURCES_ARCH_GFS "<nodes>1:ppn=1:tpp=1</nodes>">
	<!ENTITY MEMORY_ARCH_GFS    "2048M">
	<!ENTITY NATIVE_ARCH_GFS    "--export=NONE">

	<!ENTITY QUEUE_POSTSND_GFS     "&QUEUE;">
	<!ENTITY WALLTIME_POSTSND_GFS  "02:00:00">
	<!ENTITY RESOURCES_POSTSND_GFS "<nodes>20:ppn=2:tpp=1</nodes>">
	<!ENTITY NATIVE_POSTSND_GFS    "--export=NONE">

	<!ENTITY QUEUE_METP_GFS     "&QUEUE;">
	<!ENTITY WALLTIME_METP_GFS  "06:00:00">
	<!ENTITY RESOURCES_METP_GFS "<nodes>1:ppn=4:tpp=1</nodes>">
	<!ENTITY NATIVE_METP_GFS    "--export=NONE">


]>

<workflow realtime="F" scheduler="&SCHEDULER;" cyclethrottle="&CYCLETHROTTLE;" taskthrottle="&TASKTHROTTLE;">

	<log verbosity="10"><cyclestr>&EXPDIR;/logs/@Y@m@d@H.log</cyclestr></log>

	<!-- Define the cycles -->
	<cycledef group="first">&SDATE;     &SDATE;     06:00:00</cycledef>
	<cycledef group="enkf" >&SDATE;     &EDATE;     06:00:00</cycledef>
	<cycledef group="gdas" >&SDATE;     &EDATE;     06:00:00</cycledef>
	<cycledef group="gfs"  >&SDATE_GFS; &EDATE_GFS; &INTERVAL_GFS;</cycledef>

<task name="gdasprep" cycledefs="gdas" maxtries="&MAXTRIES;">

	<command>&JOBS_DIR;/prep.sh</command>

	<jobname><cyclestr>&PSLOT;_gdasprep_@H</cyclestr></jobname>
	<account>&ACCOUNT;</account>
	<queue>&QUEUE_PREP_GDAS;</queue>
	&RESOURCES_PREP_GDAS;
	<walltime>&WALLTIME_PREP_GDAS;</walltime>
	
	<native>&NATIVE_PREP_GDAS;</native>

	<join><cyclestr>&ROTDIR;/logs/@Y@m@d@H/gdasprep.log</cyclestr></join>

	<envar><name>SLURM_SET</name><value>YES</value></envar>
	<envar><name>RUN_ENVIR</name><value>&RUN_ENVIR;</value></envar>
	<envar><name>HOMEgfs</name><value>&HOMEgfs;</value></envar>
	<envar><name>EXPDIR</name><value>&EXPDIR;</value></envar>
	<envar><name>CDATE</name><value><cyclestr>@Y@m@d@H</cyclestr></value></envar>
	<envar><name>CDUMP</name><value>gdas</value></envar>
	<envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
	<envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>

	<dependency>
		<and>
			<metataskdep metatask="gdaspost" cycle_offset="-06:00:00"/>
			<datadep><cyclestr offset="-06:00:00">&ROTDIR;/gdas.@Y@m@d/@H/atmos/gdas.t@Hz.atmf009.nc</cyclestr></datadep>
			<datadep><cyclestr>&DMPDIR;/gdas.@Y@m@d/@H/gdas.t@Hz.updated.status.tm00.bufr_d</cyclestr></datadep>
		</and>
	</dependency>

</task>

<task name="gdasanal" cycledefs="gdas" maxtries="&MAXTRIES;">

	<command>&JOBS_DIR;/anal.sh</command>

	<jobname><cyclestr>&PSLOT;_gdasanal_@H</cyclestr></jobname>
	<account>&ACCOUNT;</account>
	<queue>&QUEUE_ANAL_GDAS;</queue>
	&RESOURCES_ANAL_GDAS;
	<walltime>&WALLTIME_ANAL_GDAS;</walltime>
	
	<native>&NATIVE_ANAL_GDAS;</native>

	<join><cyclestr>&ROTDIR;/logs/@Y@m@d@H/gdasanal.log</cyclestr></join>

	<envar><name>SLURM_SET</name><value>YES</value></envar>
	<envar><name>RUN_ENVIR</name><value>&RUN_ENVIR;</value></envar>
	<envar><name>HOMEgfs</name><value>&HOMEgfs;</value></envar>
	<envar><name>EXPDIR</name><value>&EXPDIR;</value></envar>
	<envar><name>CDATE</name><value><cyclestr>@Y@m@d@H</cyclestr></value></envar>
	<envar><name>CDUMP</name><value>gdas</value></envar>
	<envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
	<envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>

	<dependency>
		<and>
			<taskdep task="gdasprep"/>
			<metataskdep metatask="gdasepmn" cycle_offset="-06:00:00"/>
		</and>
	</dependency>

</task>

<task name="gdasanalcalc" cycledefs="gdas" maxtries="&MAXTRIES;">

	<command>&JOBS_DIR;/analcalc.sh</command>

	<jobname><cyclestr>&PSLOT;_gdasanalcalc_@H</cyclestr></jobname>
	<account>&ACCOUNT;</account>
	<queue>&QUEUE_ANALCALC_GDAS;</queue>
	&RESOURCES_ANALCALC_GDAS;
	<walltime>&WALLTIME_ANALCALC_GDAS;</walltime>
	
	<native>&NATIVE_ANALCALC_GDAS;</native>

	<join><cyclestr>&ROTDIR;/logs/@Y@m@d@H/gdasanalcalc.log</cyclestr></join>

	<envar><name>SLURM_SET</name><value>YES</value></envar>
	<envar><name>RUN_ENVIR</name><value>&RUN_ENVIR;</value></envar>
	<envar><name>HOMEgfs</name><value>&HOMEgfs;</value></envar>
	<envar><name>EXPDIR</name><value>&EXPDIR;</value></envar>
	<envar><name>CDATE</name><value><cyclestr>@Y@m@d@H</cyclestr></value></envar>
	<envar><name>CDUMP</name><value>gdas</value></envar>
	<envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
	<envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>

	<dependency>
		<and>
			<taskdep task="gdasprep"/>
			<metataskdep metatask="gdasepmn" cycle_offset="-06:00:00"/>
			<taskdep task="gdasanal"/>
			<taskdep task="gdasechgres" cycle_offset="-06:00:00"/>
		</and>
	</dependency>

</task>

<task name="gdasanaldiag" cycledefs="gdas" maxtries="&MAXTRIES;">

	<command>&JOBS_DIR;/analdiag.sh</command>

	<jobname><cyclestr>&PSLOT;_gdasanaldiag_@H</cyclestr></jobname>
	<account>&ACCOUNT;</account>
	<queue>&QUEUE_ANALDIAG_GDAS;</queue>
	&RESOURCES_ANALDIAG_GDAS;
	<walltime>&WALLTIME_ANALDIAG_GDAS;</walltime>
	
	<native>&NATIVE_ANALDIAG_GDAS;</native>

	<join><cyclestr>&ROTDIR;/logs/@Y@m@d@H/gdasanaldiag.log</cyclestr></join>

	<envar><name>SLURM_SET</name><value>YES</value></envar>
	<envar><name>RUN_ENVIR</name><value>&RUN_ENVIR;</value></envar>
	<envar><name>HOMEgfs</name><value>&HOMEgfs;</value></envar>
	<envar><name>EXPDIR</name><value>&EXPDIR;</value></envar>
	<envar><name>CDATE</name><value><cyclestr>@Y@m@d@H</cyclestr></value></envar>
	<envar><name>CDUMP</name><value>gdas</value></envar>
	<envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
	<envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>

	<dependency>
		<and>
			<or>
				<datadep><cyclestr>&ROTDIR;/gdas.@Y@m@d/@H/atmos/gdas.t@Hz.loginc.txt</cyclestr></datadep>
				<taskdep task="gdasanal"/>
			</or>
			<cycleexistdep cycle_offset="-06:00:00"/>
		</and>
	</dependency>

</task>

<task name="gdasgldas" cycledefs="gdas" maxtries="&MAXTRIES;">

	<command>&JOBS_DIR;/gldas.sh</command>

	<jobname><cyclestr>&PSLOT;_gdasgldas_@H</cyclestr></jobname>
	<account>&ACCOUNT;</account>
	<queue>&QUEUE_GLDAS_GDAS;</queue>
	&RESOURCES_GLDAS_GDAS;
	<walltime>&WALLTIME_GLDAS_GDAS;</walltime>
	
	<native>&NATIVE_GLDAS_GDAS;</native>

	<join><cyclestr>&ROTDIR;/logs/@Y@m@d@H/gdasgldas.log</cyclestr></join>

	<envar><name>SLURM_SET</name><value>YES</value></envar>
	<envar><name>RUN_ENVIR</name><value>&RUN_ENVIR;</value></envar>
	<envar><name>HOMEgfs</name><value>&HOMEgfs;</value></envar>
	<envar><name>EXPDIR</name><value>&EXPDIR;</value></envar>
	<envar><name>CDATE</name><value><cyclestr>@Y@m@d@H</cyclestr></value></envar>
	<envar><name>CDUMP</name><value>gdas</value></envar>
	<envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
	<envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>

	<dependency>
		<and>
			<or>
				<datadep><cyclestr>&ROTDIR;/gdas.@Y@m@d/@H/atmos/gdas.t@Hz.loginc.txt</cyclestr></datadep>
				<taskdep task="gdasanal"/>
			</or>
			<cycleexistdep cycle_offset="-06:00:00"/>
		</and>
	</dependency>

</task>

<task name="gdasfcst" cycledefs="gdas" maxtries="&MAXTRIES;">

	<command>&JOBS_DIR;/fcst.sh</command>

	<jobname><cyclestr>&PSLOT;_gdasfcst_@H</cyclestr></jobname>
	<account>&ACCOUNT;</account>
	<queue>&QUEUE_FCST_GDAS;</queue>
	&RESOURCES_FCST_GDAS;
	<walltime>&WALLTIME_FCST_GDAS;</walltime>
	
	<native>&NATIVE_FCST_GDAS;</native>

	<join><cyclestr>&ROTDIR;/logs/@Y@m@d@H/gdasfcst.log</cyclestr></join>

	<envar><name>SLURM_SET</name><value>YES</value></envar>
	<envar><name>RUN_ENVIR</name><value>&RUN_ENVIR;</value></envar>
	<envar><name>HOMEgfs</name><value>&HOMEgfs;</value></envar>
	<envar><name>EXPDIR</name><value>&EXPDIR;</value></envar>
	<envar><name>CDATE</name><value><cyclestr>@Y@m@d@H</cyclestr></value></envar>
	<envar><name>CDUMP</name><value>gdas</value></envar>
	<envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
	<envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>

	<dependency>
		<or>
			<not><cycleexistdep cycle_offset="-06:00:00"/></not>
			<taskdep task="gdasgldas"/>
		</or>
	</dependency>

</task>

<metatask name="gdaspost">

	<var name="grp">000 001 002 003 004 005 006 007 008 009 010</var>
	<var name="dep">anl f000 f001 f002 f003 f004 f005 f006 f007 f008 f009</var>
	<var name="lst">anl f000 f001 f002 f003 f004 f005 f006 f007 f008 f009</var>

	<task name="gdaspost#grp#" cycledefs="gdas" maxtries="&MAXTRIES;">

		<command>&JOBS_DIR;/post.sh</command>

		<jobname><cyclestr>&PSLOT;_gdaspost#grp#_@H</cyclestr></jobname>
		<account>&ACCOUNT;</account>
		<queue>&QUEUE_POST_GDAS;</queue>
		&RESOURCES_POST_GDAS;
		<walltime>&WALLTIME_POST_GDAS;</walltime>
		
		<native>&NATIVE_POST_GDAS;</native>

		<join><cyclestr>&ROTDIR;/logs/@Y@m@d@H/gdaspost#grp#.log</cyclestr></join>

		<envar><name>SLURM_SET</name><value>YES</value></envar>
		<envar><name>RUN_ENVIR</name><value>&RUN_ENVIR;</value></envar>
		<envar><name>HOMEgfs</name><value>&HOMEgfs;</value></envar>
		<envar><name>EXPDIR</name><value>&EXPDIR;</value></envar>
		<envar><name>CDATE</name><value><cyclestr>@Y@m@d@H</cyclestr></value></envar>
		<envar><name>CDUMP</name><value>gdas</value></envar>
		<envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
		<envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
		<envar><name>FHRGRP</name><value>#grp#</value></envar>
		<envar><name>FHRLST</name><value>#lst#</value></envar>
		<envar><name>ROTDIR</name><value>&ROTDIR;</value></envar>

		<dependency>
			<or>
				<datadep><cyclestr>&ROTDIR;/gdas.@Y@m@d/@H/atmos/gdas.t@Hz.log#dep#.txt</cyclestr></datadep>
				<taskdep task="gdasfcst"/>
			</or>
		</dependency>

	</task>

</metatask>

<task name="gdasvrfy" cycledefs="gdas" maxtries="&MAXTRIES;">

	<command>&JOBS_DIR;/vrfy.sh</command>

	<jobname><cyclestr>&PSLOT;_gdasvrfy_@H</cyclestr></jobname>
	<account>&ACCOUNT;</account>
	<queue>&QUEUE_VRFY_GDAS;</queue>
	&RESOURCES_VRFY_GDAS;
	<walltime>&WALLTIME_VRFY_GDAS;</walltime>
	<memory>&MEMORY_VRFY_GDAS;</memory>
	<native>&NATIVE_VRFY_GDAS;</native>

	<join><cyclestr>&ROTDIR;/logs/@Y@m@d@H/gdasvrfy.log</cyclestr></join>

	<envar><name>SLURM_SET</name><value>YES</value></envar>
	<envar><name>RUN_ENVIR</name><value>&RUN_ENVIR;</value></envar>
	<envar><name>HOMEgfs</name><value>&HOMEgfs;</value></envar>
	<envar><name>EXPDIR</name><value>&EXPDIR;</value></envar>
	<envar><name>CDATE</name><value><cyclestr>@Y@m@d@H</cyclestr></value></envar>
	<envar><name>CDUMP</name><value>gdas</value></envar>
	<envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
	<envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>

	<dependency>
		<metataskdep metatask="gdaspost"/>
	</dependency>

</task>

<task name="gdasarch" cycledefs="gdas" maxtries="&MAXTRIES;">

	<command>&JOBS_DIR;/arch.sh</command>

	<jobname><cyclestr>&PSLOT;_gdasarch_@H</cyclestr></jobname>
	<account>&ACCOUNT;</account>
	<queue>&QUEUE_ARCH_GDAS;</queue>
	<partition>&PARTITION_ARCH_GDAS;</partition>
	&RESOURCES_ARCH_GDAS;
	<walltime>&WALLTIME_ARCH_GDAS;</walltime>
	<memory>&MEMORY_ARCH_GDAS;</memory>
	<native>&NATIVE_ARCH_GDAS;</native>

	<join><cyclestr>&ROTDIR;/logs/@Y@m@d@H/gdasarch.log</cyclestr></join>

	<envar><name>SLURM_SET</name><value>YES</value></envar>
	<envar><name>RUN_ENVIR</name><value>&RUN_ENVIR;</value></envar>
	<envar><name>HOMEgfs</name><value>&HOMEgfs;</value></envar>
	<envar><name>EXPDIR</name><value>&EXPDIR;</value></envar>
	<envar><name>CDATE</name><value><cyclestr>@Y@m@d@H</cyclestr></value></envar>
	<envar><name>CDUMP</name><value>gdas</value></envar>
	<envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
	<envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>

	<dependency>
		<and>
			<taskdep task="gdasvrfy"/>
			<streq><left>&ARCHIVE_TO_HPSS;</left><right>YES</right></streq>
		</and>
	</dependency>

</task>

<task name="gdaseobs" cycledefs="enkf" maxtries="&MAXTRIES;">

	<command>&JOBS_DIR;/eobs.sh</command>

	<jobname><cyclestr>&PSLOT;_gdaseobs_@H</cyclestr></jobname>
	<account>&ACCOUNT;</account>
	<queue>&QUEUE_EOBS_GDAS;</queue>
	&RESOURCES_EOBS_GDAS;
	<walltime>&WALLTIME_EOBS_GDAS;</walltime>
	
	<native>&NATIVE_EOBS_GDAS;</native>

	<join><cyclestr>&ROTDIR;/logs/@Y@m@d@H/gdaseobs.log</cyclestr></join>

	<envar><name>SLURM_SET</name><value>YES</value></envar>
	<envar><name>RUN_ENVIR</name><value>&RUN_ENVIR;</value></envar>
	<envar><name>HOMEgfs</name><value>&HOMEgfs;</value></envar>
	<envar><name>EXPDIR</name><value>&EXPDIR;</value></envar>
	<envar><name>CDATE</name><value><cyclestr>@Y@m@d@H</cyclestr></value></envar>
	<envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
	<envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
	<envar><name>CDUMP</name><value>gdas</value></envar>

	<dependency>
		<and>
			<taskdep task="gdasprep"/>
			<metataskdep metatask="gdasepmn" cycle_offset="-06:00:00"/>
		</and>
	</dependency>

</task>

<task name="gdasediag" cycledefs="enkf" maxtries="&MAXTRIES;">

	<command>&JOBS_DIR;/ediag.sh</command>

	<jobname><cyclestr>&PSLOT;_gdasediag_@H</cyclestr></jobname>
	<account>&ACCOUNT;</account>
	<queue>&QUEUE_EDIAG_GDAS;</queue>
	&RESOURCES_EDIAG_GDAS;
	<walltime>&WALLTIME_EDIAG_GDAS;</walltime>
	
	<native>&NATIVE_EDIAG_GDAS;</native>

	<join><cyclestr>&ROTDIR;/logs/@Y@m@d@H/gdasediag.log</cyclestr></join>

	<envar><name>SLURM_SET</name><value>YES</value></envar>
	<envar><name>RUN_ENVIR</name><value>&RUN_ENVIR;</value></envar>
	<envar><name>HOMEgfs</name><value>&HOMEgfs;</value></envar>
	<envar><name>EXPDIR</name><value>&EXPDIR;</value></envar>
	<envar><name>CDATE</name><value><cyclestr>@Y@m@d@H</cyclestr></value></envar>
	<envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
	<envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
	<envar><name>CDUMP</name><value>gdas</value></envar>

	<dependency>
		<taskdep task="gdaseobs"/>
	</dependency>

</task>

<task name="gdaseupd" cycledefs="enkf" maxtries="&MAXTRIES;">

	<command>&JOBS_DIR;/eupd.sh</command>

	<jobname><cyclestr>&PSLOT;_gdaseupd_@H</cyclestr></jobname>
	<account>&ACCOUNT;</account>
	<queue>&QUEUE_EUPD_GDAS;</queue>
	&RESOURCES_EUPD_GDAS;
	<walltime>&WALLTIME_EUPD_GDAS;</walltime>
	
	<native>&NATIVE_EUPD_GDAS;</native>

	<join><cyclestr>&ROTDIR;/logs/@Y@m@d@H/gdaseupd.log</cyclestr></join>

	<envar><name>SLURM_SET</name><value>YES</value></envar>
	<envar><name>RUN_ENVIR</name><value>&RUN_ENVIR;</value></envar>
	<envar><name>HOMEgfs</name><value>&HOMEgfs;</value></envar>
	<envar><name>EXPDIR</name><value>&EXPDIR;</value></envar>
	<envar><name>CDATE</name><value><cyclestr>@Y@m@d@H</cyclestr></value></envar>
	<envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
	<envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
	<envar><name>CDUMP</name><value>gdas</value></envar>

	<dependency>
		<taskdep task="gdasediag"/>
	</dependency>

</task>

<metatask name="gdasecmn">

	<var name="grp">000 001 002</var>
	<var name="dep">f003 f006 f009</var>
	<var name="lst">f003 f006 f009</var>

	<task name="gdasecen#grp#" cycledefs="gdas" maxtries="&MAXTRIES;">

		<command>&JOBS_DIR;/ecen.sh</command>

		<jobname><cyclestr>&PSLOT;_gdasecen#grp#_@H</cyclestr></jobname>
		<account>&ACCOUNT;</account>
		<queue>&QUEUE_ECEN_GDAS;</queue>
		&RESOURCES_ECEN_GDAS;
		<walltime>&WALLTIME_ECEN_GDAS;</walltime>
		
		<native>&NATIVE_ECEN_GDAS;</native>

		<join><cyclestr>&ROTDIR;/logs/@Y@m@d@H/gdasecen#grp#.log</cyclestr></join>

		<envar><name>SLURM_SET</name><value>YES</value></envar>
		<envar><name>RUN_ENVIR</name><value>&RUN_ENVIR;</value></envar>
		<envar><name>HOMEgfs</name><value>&HOMEgfs;</value></envar>
		<envar><name>EXPDIR</name><value>&EXPDIR;</value></envar>
		<envar><name>CDATE</name><value><cyclestr>@Y@m@d@H</cyclestr></value></envar>
		<envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
		<envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
		<envar><name>CDUMP</name><value>gdas</value></envar>
		<envar><name>FHRGRP</name><value>#grp#</value></envar>
		<envar><name>FHRLST</name><value>#lst#</value></envar>

		<dependency>
			<and>
				<or>
					<datadep><cyclestr>&ROTDIR;/gdas.@Y@m@d/@H/atmos/gdas.t@Hz.loganl.txt</cyclestr></datadep>
					<taskdep task="gdasanalcalc"/>
				</or>
				<taskdep task="gdaseupd"/>
			</and>
		</dependency>

	</task>

</metatask>

<task name="gdasesfc" cycledefs="enkf" maxtries="&MAXTRIES;">

	<command>&JOBS_DIR;/esfc.sh</command>

	<jobname><cyclestr>&PSLOT;_gdasesfc_@H</cyclestr></jobname>
	<account>&ACCOUNT;</account>
	<queue>&QUEUE_ESFC_GDAS;</queue>
	&RESOURCES_ESFC_GDAS;
	<walltime>&WALLTIME_ESFC_GDAS;</walltime>
	
	<native>&NATIVE_ESFC_GDAS;</native>

	<join><cyclestr>&ROTDIR;/logs/@Y@m@d@H/gdasesfc.log</cyclestr></join>

	<envar><name>SLURM_SET</name><value>YES</value></envar>
	<envar><name>RUN_ENVIR</name><value>&RUN_ENVIR;</value></envar>
	<envar><name>HOMEgfs</name><value>&HOMEgfs;</value></envar>
	<envar><name>EXPDIR</name><value>&EXPDIR;</value></envar>
	<envar><name>CDATE</name><value><cyclestr>@Y@m@d@H</cyclestr></value></envar>
	<envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
	<envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
	<envar><name>CDUMP</name><value>gdas</value></envar>

	<dependency>
		<and>
			<or>
				<datadep><cyclestr>&ROTDIR;/gdas.@Y@m@d/@H/atmos/gdas.t@Hz.loganl.txt</cyclestr></datadep>
				<taskdep task="gdasanalcalc"/>
			</or>
			<taskdep task="gdaseupd"/>
		</and>
	</dependency>

</task>

<metatask name="gdasefmn">

	<var name="grp">01 02 03 04 05 06 07 08 09 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40</var>

	<task name="gdasefcs#grp#" cycledefs="enkf" maxtries="&MAXTRIES;">

		<command>&JOBS_DIR;/efcs.sh</command>

		<jobname><cyclestr>&PSLOT;_gdasefcs#grp#_@H</cyclestr></jobname>
		<account>&ACCOUNT;</account>
		<queue>&QUEUE_EFCS_GDAS;</queue>
		&RESOURCES_EFCS_GDAS;
		<walltime>&WALLTIME_EFCS_GDAS;</walltime>
		
		<native>&NATIVE_EFCS_GDAS;</native>

		<join><cyclestr>&ROTDIR;/logs/@Y@m@d@H/gdasefcs#grp#.log</cyclestr></join>

		<envar><name>SLURM_SET</name><value>YES</value></envar>
		<envar><name>RUN_ENVIR</name><value>&RUN_ENVIR;</value></envar>
		<envar><name>HOMEgfs</name><value>&HOMEgfs;</value></envar>
		<envar><name>EXPDIR</name><value>&EXPDIR;</value></envar>
		<envar><name>CDATE</name><value><cyclestr>@Y@m@d@H</cyclestr></value></envar>
		<envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
		<envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
		<envar><name>CDUMP</name><value>gdas</value></envar>
		<envar><name>ENSGRP</name><value>#grp#</value></envar>

		<dependency>
			<or>
				<and>
					<metataskdep metatask="gdasecmn"/>
					<taskdep task="gdasesfc"/>
				</and>
				<not><cycleexistdep cycle_offset="-06:00:00"/></not>
			</or>
		</dependency>

	</task>

</metatask>

<task name="gdasechgres" cycledefs="enkf" maxtries="&MAXTRIES;">

	<command>&JOBS_DIR;/echgres.sh</command>

	<jobname><cyclestr>&PSLOT;_gdasechgres_@H</cyclestr></jobname>
	<account>&ACCOUNT;</account>
	<queue>&QUEUE_ECHGRES_GDAS;</queue>
	&RESOURCES_ECHGRES_GDAS;
	<walltime>&WALLTIME_ECHGRES_GDAS;</walltime>
	
	<native>&NATIVE_ECHGRES_GDAS;</native>

	<join><cyclestr>&ROTDIR;/logs/@Y@m@d@H/gdasechgres.log</cyclestr></join>

	<envar><name>SLURM_SET</name><value>YES</value></envar>
	<envar><name>RUN_ENVIR</name><value>&RUN_ENVIR;</value></envar>
	<envar><name>HOMEgfs</name><value>&HOMEgfs;</value></envar>
	<envar><name>EXPDIR</name><value>&EXPDIR;</value></envar>
	<envar><name>CDATE</name><value><cyclestr>@Y@m@d@H</cyclestr></value></envar>
	<envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
	<envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
	<envar><name>CDUMP</name><value>gdas</value></envar>

	<dependency>
		<and>
			<taskdep task="gdasfcst"/>
			<metataskdep metatask="gdasefmn"/>
		</and>
	</dependency>

</task>

<metatask name="gdasepmn">

	<var name="grp">000 001 002 003 004 005 006</var>
	<var name="dep">f003 f004 f005 f006 f007 f008 f009</var>
	<var name="lst">f003 f004 f005 f006 f007 f008 f009</var>

	<task name="gdasepos#grp#" cycledefs="gdas" maxtries="&MAXTRIES;">

		<command>&JOBS_DIR;/epos.sh</command>

		<jobname><cyclestr>&PSLOT;_gdasepos#grp#_@H</cyclestr></jobname>
		<account>&ACCOUNT;</account>
		<queue>&QUEUE_EPOS_GDAS;</queue>
		&RESOURCES_EPOS_GDAS;
		<walltime>&WALLTIME_EPOS_GDAS;</walltime>
		
		<native>&NATIVE_EPOS_GDAS;</native>

		<join><cyclestr>&ROTDIR;/logs/@Y@m@d@H/gdasepos#grp#.log</cyclestr></join>

		<envar><name>SLURM_SET</name><value>YES</value></envar>
		<envar><name>RUN_ENVIR</name><value>&RUN_ENVIR;</value></envar>
		<envar><name>HOMEgfs</name><value>&HOMEgfs;</value></envar>
		<envar><name>EXPDIR</name><value>&EXPDIR;</value></envar>
		<envar><name>CDATE</name><value><cyclestr>@Y@m@d@H</cyclestr></value></envar>
		<envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
		<envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
		<envar><name>CDUMP</name><value>gdas</value></envar>
		<envar><name>FHRGRP</name><value>#grp#</value></envar>
		<envar><name>FHRLST</name><value>#lst#</value></envar>

		<dependency>
			<metataskdep metatask="gdasefmn"/>
		</dependency>

	</task>

</metatask>

<metatask name="gdaseamn">

	<var name="grp">00 01 02 03 04 05 06 07 08</var>

	<task name="gdasearc#grp#" cycledefs="enkf" maxtries="&MAXTRIES;">

		<command>&JOBS_DIR;/earc.sh</command>

		<jobname><cyclestr>&PSLOT;_gdasearc#grp#_@H</cyclestr></jobname>
		<account>&ACCOUNT;</account>
		<queue>&QUEUE_EARC_GDAS;</queue>
		<partition>&PARTITION_EARC_GDAS;</partition>
		&RESOURCES_EARC_GDAS;
		<walltime>&WALLTIME_EARC_GDAS;</walltime>
		<memory>&MEMORY_EARC_GDAS;</memory>
		<native>&NATIVE_EARC_GDAS;</native>

		<join><cyclestr>&ROTDIR;/logs/@Y@m@d@H/gdasearc#grp#.log</cyclestr></join>

		<envar><name>SLURM_SET</name><value>YES</value></envar>
		<envar><name>RUN_ENVIR</name><value>&RUN_ENVIR;</value></envar>
		<envar><name>HOMEgfs</name><value>&HOMEgfs;</value></envar>
		<envar><name>EXPDIR</name><value>&EXPDIR;</value></envar>
		<envar><name>CDATE</name><value><cyclestr>@Y@m@d@H</cyclestr></value></envar>
		<envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
		<envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
		<envar><name>CDUMP</name><value>gdas</value></envar>
		<envar><name>ENSGRP</name><value>#grp#</value></envar>

		<dependency>
			<metataskdep metatask="gdasepmn"/>
		</dependency>

	</task>

</metatask>

<task name="gfsprep" cycledefs="gfs" maxtries="&MAXTRIES;">

	<command>&JOBS_DIR;/prep.sh</command>

	<jobname><cyclestr>&PSLOT;_gfsprep_@H</cyclestr></jobname>
	<account>&ACCOUNT;</account>
	<queue>&QUEUE_PREP_GFS;</queue>
	&RESOURCES_PREP_GFS;
	<walltime>&WALLTIME_PREP_GFS;</walltime>
	
	<native>&NATIVE_PREP_GFS;</native>

	<join><cyclestr>&ROTDIR;/logs/@Y@m@d@H/gfsprep.log</cyclestr></join>

	<envar><name>SLURM_SET</name><value>YES</value></envar>
	<envar><name>RUN_ENVIR</name><value>&RUN_ENVIR;</value></envar>
	<envar><name>HOMEgfs</name><value>&HOMEgfs;</value></envar>
	<envar><name>EXPDIR</name><value>&EXPDIR;</value></envar>
	<envar><name>CDATE</name><value><cyclestr>@Y@m@d@H</cyclestr></value></envar>
	<envar><name>CDUMP</name><value>gfs</value></envar>
	<envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
	<envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>

	<dependency>
		<and>
			<metataskdep metatask="gdaspost" cycle_offset="-06:00:00"/>
			<datadep><cyclestr offset="-06:00:00">&ROTDIR;/gdas.@Y@m@d/@H/atmos/gdas.t@Hz.atmf009.nc</cyclestr></datadep>
			<datadep><cyclestr>&DMPDIR;/gfs.@Y@m@d/@H/gfs.t@Hz.updated.status.tm00.bufr_d</cyclestr></datadep>
		</and>
	</dependency>

</task>

<task name="gfsanal" cycledefs="gfs" maxtries="&MAXTRIES;">

	<command>&JOBS_DIR;/anal.sh</command>

	<jobname><cyclestr>&PSLOT;_gfsanal_@H</cyclestr></jobname>
	<account>&ACCOUNT;</account>
	<queue>&QUEUE_ANAL_GFS;</queue>
	&RESOURCES_ANAL_GFS;
	<walltime>&WALLTIME_ANAL_GFS;</walltime>
	
	<native>&NATIVE_ANAL_GFS;</native>

	<join><cyclestr>&ROTDIR;/logs/@Y@m@d@H/gfsanal.log</cyclestr></join>

	<envar><name>SLURM_SET</name><value>YES</value></envar>
	<envar><name>RUN_ENVIR</name><value>&RUN_ENVIR;</value></envar>
	<envar><name>HOMEgfs</name><value>&HOMEgfs;</value></envar>
	<envar><name>EXPDIR</name><value>&EXPDIR;</value></envar>
	<envar><name>CDATE</name><value><cyclestr>@Y@m@d@H</cyclestr></value></envar>
	<envar><name>CDUMP</name><value>gfs</value></envar>
	<envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
	<envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>

	<dependency>
		<and>
			<taskdep task="gfsprep"/>
			<metataskdep metatask="gdasepmn" cycle_offset="-06:00:00"/>
		</and>
	</dependency>

</task>

<task name="gfsanalcalc" cycledefs="gfs" maxtries="&MAXTRIES;">

	<command>&JOBS_DIR;/analcalc.sh</command>

	<jobname><cyclestr>&PSLOT;_gfsanalcalc_@H</cyclestr></jobname>
	<account>&ACCOUNT;</account>
	<queue>&QUEUE_ANALCALC_GFS;</queue>
	&RESOURCES_ANALCALC_GFS;
	<walltime>&WALLTIME_ANALCALC_GFS;</walltime>
	
	<native>&NATIVE_ANALCALC_GFS;</native>

	<join><cyclestr>&ROTDIR;/logs/@Y@m@d@H/gfsanalcalc.log</cyclestr></join>

	<envar><name>SLURM_SET</name><value>YES</value></envar>
	<envar><name>RUN_ENVIR</name><value>&RUN_ENVIR;</value></envar>
	<envar><name>HOMEgfs</name><value>&HOMEgfs;</value></envar>
	<envar><name>EXPDIR</name><value>&EXPDIR;</value></envar>
	<envar><name>CDATE</name><value><cyclestr>@Y@m@d@H</cyclestr></value></envar>
	<envar><name>CDUMP</name><value>gfs</value></envar>
	<envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
	<envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>

	<dependency>
		<and>
			<taskdep task="gfsprep"/>
			<metataskdep metatask="gdasepmn" cycle_offset="-06:00:00"/>
			<taskdep task="gfsanal"/>
		</and>
	</dependency>

</task>

<task name="gfsfcst" cycledefs="gfs" maxtries="&MAXTRIES;">

	<command>&JOBS_DIR;/fcst.sh</command>

	<jobname><cyclestr>&PSLOT;_gfsfcst_@H</cyclestr></jobname>
	<account>&ACCOUNT;</account>
	<queue>&QUEUE_FCST_GFS;</queue>
	&RESOURCES_FCST_GFS;
	<walltime>&WALLTIME_FCST_GFS;</walltime>
	
	<native>&NATIVE_FCST_GFS;</native>

	<join><cyclestr>&ROTDIR;/logs/@Y@m@d@H/gfsfcst.log</cyclestr></join>

	<envar><name>SLURM_SET</name><value>YES</value></envar>
	<envar><name>RUN_ENVIR</name><value>&RUN_ENVIR;</value></envar>
	<envar><name>HOMEgfs</name><value>&HOMEgfs;</value></envar>
	<envar><name>EXPDIR</name><value>&EXPDIR;</value></envar>
	<envar><name>CDATE</name><value><cyclestr>@Y@m@d@H</cyclestr></value></envar>
	<envar><name>CDUMP</name><value>gfs</value></envar>
	<envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
	<envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>

	<dependency>
		<or>
			<taskdep task="gfsanal"/>
		</or>
	</dependency>

</task>

<metatask name="gfspost">

	<var name="grp">000 001 002 003 004 005 006 007 008 009 010 011 012 013 014 015 016 017 018 019 020 021 022 023 024 025 026 027 028 029 030 031 032 033 034 035 036 037 038 039 040 041 042</var>
	<var name="dep">anl f009 f021 f033 f042 f051 f060 f069 f078 f087 f096 f105 f114 f123 f132 f141 f150 f159 f168 f177 f186 f195 f204 f213 f222 f231 f240 f249 f258 f267 f276 f285 f294 f303 f312 f321 f330 f339 f348 f357 f366 f375 f384</var>
	<var name="lst">anl f000_f003_f006_f009 f012_f015_f018_f021 f024_f027_f030_f033 f036_f039_f042 f045_f048_f051 f054_f057_f060 f063_f066_f069 f072_f075_f078 f081_f084_f087 f090_f093_f096 f099_f102_f105 f108_f111_f114 f117_f120_f123 f126_f129_f132 f135_f138_f141 f144_f147_f150 f153_f156_f159 f162_f165_f168 f171_f174_f177 f180_f183_f186 f189_f192_f195 f198_f201_f204 f207_f210_f213 f216_f219_f222 f225_f228_f231 f234_f237_f240 f243_f246_f249 f252_f255_f258 f261_f264_f267 f270_f273_f276 f279_f282_f285 f288_f291_f294 f297_f300_f303 f306_f309_f312 f315_f318_f321 f324_f327_f330 f333_f336_f339 f342_f345_f348 f351_f354_f357 f360_f363_f366 f369_f372_f375 f378_f381_f384</var>

	<task name="gfspost#grp#" cycledefs="gfs" maxtries="&MAXTRIES;">

		<command>&JOBS_DIR;/post.sh</command>

		<jobname><cyclestr>&PSLOT;_gfspost#grp#_@H</cyclestr></jobname>
		<account>&ACCOUNT;</account>
		<queue>&QUEUE_POST_GFS;</queue>
		&RESOURCES_POST_GFS;
		<walltime>&WALLTIME_POST_GFS;</walltime>
		
		<native>&NATIVE_POST_GFS;</native>

		<join><cyclestr>&ROTDIR;/logs/@Y@m@d@H/gfspost#grp#.log</cyclestr></join>

		<envar><name>SLURM_SET</name><value>YES</value></envar>
		<envar><name>RUN_ENVIR</name><value>&RUN_ENVIR;</value></envar>
		<envar><name>HOMEgfs</name><value>&HOMEgfs;</value></envar>
		<envar><name>EXPDIR</name><value>&EXPDIR;</value></envar>
		<envar><name>CDATE</name><value><cyclestr>@Y@m@d@H</cyclestr></value></envar>
		<envar><name>CDUMP</name><value>gfs</value></envar>
		<envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
		<envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
		<envar><name>FHRGRP</name><value>#grp#</value></envar>
		<envar><name>FHRLST</name><value>#lst#</value></envar>
		<envar><name>ROTDIR</name><value>&ROTDIR;</value></envar>

		<dependency>
			<or>
				<datadep><cyclestr>&ROTDIR;/gfs.@Y@m@d/@H/atmos/gfs.t@Hz.log#dep#.txt</cyclestr></datadep>
				<taskdep task="gfsfcst"/>
			</or>
		</dependency>

	</task>

</metatask>

<task name="gfsvrfy" cycledefs="gfs" maxtries="&MAXTRIES;">

	<command>&JOBS_DIR;/vrfy.sh</command>

	<jobname><cyclestr>&PSLOT;_gfsvrfy_@H</cyclestr></jobname>
	<account>&ACCOUNT;</account>
	<queue>&QUEUE_VRFY_GFS;</queue>
	&RESOURCES_VRFY_GFS;
	<walltime>&WALLTIME_VRFY_GFS;</walltime>
	<memory>&MEMORY_VRFY_GFS;</memory>
	<native>&NATIVE_VRFY_GFS;</native>

	<join><cyclestr>&ROTDIR;/logs/@Y@m@d@H/gfsvrfy.log</cyclestr></join>

	<envar><name>SLURM_SET</name><value>YES</value></envar>
	<envar><name>RUN_ENVIR</name><value>&RUN_ENVIR;</value></envar>
	<envar><name>HOMEgfs</name><value>&HOMEgfs;</value></envar>
	<envar><name>EXPDIR</name><value>&EXPDIR;</value></envar>
	<envar><name>CDATE</name><value><cyclestr>@Y@m@d@H</cyclestr></value></envar>
	<envar><name>CDUMP</name><value>gfs</value></envar>
	<envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
	<envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>

	<dependency>
		<metataskdep metatask="gfspost"/>
	</dependency>

</task>

<metatask name="gfsmetp">

	<var name="metpcase">g2g1 g2o1 pcp1</var>

	<task name="gfsmetp#metpcase#" cycledefs="gfs" maxtries="&MAXTRIES;">

		<command>&JOBS_DIR;/metp.sh</command>

		<jobname><cyclestr>&PSLOT;_gfsmetp#metpcase#_@H</cyclestr></jobname>
		<account>&ACCOUNT;</account>
		<queue>&QUEUE_METP_GFS;</queue>
		&RESOURCES_METP_GFS;
		<walltime>&WALLTIME_METP_GFS;</walltime>
		
		<native>&NATIVE_METP_GFS;</native>

		<join><cyclestr>&ROTDIR;/logs/@Y@m@d@H/gfsmetp#metpcase#.log</cyclestr></join>

		<envar><name>SLURM_SET</name><value>YES</value></envar>
		<envar><name>RUN_ENVIR</name><value>&RUN_ENVIR;</value></envar>
		<envar><name>HOMEgfs</name><value>&HOMEgfs;</value></envar>
		<envar><name>EXPDIR</name><value>&EXPDIR;</value></envar>
		<envar><name>CDATE</name><value><cyclestr>@Y@m@d@H</cyclestr></value></envar>
		<envar><name>CDUMP</name><value>gfs</value></envar>
		<envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
		<envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
		<envar><name>METPCASE</name><value>#metpcase#</value></envar>

		<dependency>
			<and>
				<metataskdep metatask="gfspost"/>
				<taskdep task="gfsarch" cycle_offset="-&INTERVAL_GFS;"/>
			</and>
		</dependency>

	</task>

</metatask>

<task name="gfspostsnd" cycledefs="gfs" maxtries="&MAXTRIES;">

	<command>&JOBS_DIR;/postsnd.sh</command>

	<jobname><cyclestr>&PSLOT;_gfspostsnd_@H</cyclestr></jobname>
	<account>&ACCOUNT;</account>
	<queue>&QUEUE_POSTSND_GFS;</queue>
	&RESOURCES_POSTSND_GFS;
	<walltime>&WALLTIME_POSTSND_GFS;</walltime>
	
	<native>&NATIVE_POSTSND_GFS;</native>

	<join><cyclestr>&ROTDIR;/logs/@Y@m@d@H/gfspostsnd.log</cyclestr></join>

	<envar><name>SLURM_SET</name><value>YES</value></envar>
	<envar><name>RUN_ENVIR</name><value>&RUN_ENVIR;</value></envar>
	<envar><name>HOMEgfs</name><value>&HOMEgfs;</value></envar>
	<envar><name>EXPDIR</name><value>&EXPDIR;</value></envar>
	<envar><name>CDATE</name><value><cyclestr>@Y@m@d@H</cyclestr></value></envar>
	<envar><name>CDUMP</name><value>gfs</value></envar>
	<envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
	<envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>

	<dependency>
		<taskdep task="gfsfcst"/>
	</dependency>

</task>

<task name="gfsarch" cycledefs="gfs" maxtries="&MAXTRIES;">

	<command>&JOBS_DIR;/arch.sh</command>

	<jobname><cyclestr>&PSLOT;_gfsarch_@H</cyclestr></jobname>
	<account>&ACCOUNT;</account>
	<queue>&QUEUE_ARCH_GFS;</queue>
	<partition>&PARTITION_ARCH_GFS;</partition>
	&RESOURCES_ARCH_GFS;
	<walltime>&WALLTIME_ARCH_GFS;</walltime>
	<memory>&MEMORY_ARCH_GFS;</memory>
	<native>&NATIVE_ARCH_GFS;</native>

	<join><cyclestr>&ROTDIR;/logs/@Y@m@d@H/gfsarch.log</cyclestr></join>

	<envar><name>SLURM_SET</name><value>YES</value></envar>
	<envar><name>RUN_ENVIR</name><value>&RUN_ENVIR;</value></envar>
	<envar><name>HOMEgfs</name><value>&HOMEgfs;</value></envar>
	<envar><name>EXPDIR</name><value>&EXPDIR;</value></envar>
	<envar><name>CDATE</name><value><cyclestr>@Y@m@d@H</cyclestr></value></envar>
	<envar><name>CDUMP</name><value>gfs</value></envar>
	<envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
	<envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>

	<dependency>
		<and>
			<taskdep task="gfsvrfy"/>
			<streq><left>&ARCHIVE_TO_HPSS;</left><right>YES</right></streq>
		</and>
	</dependency>

</task>

<task name="firstcyc" cycledefs="first" maxtries="&MAXTRIES;" final="true">

	<command>sleep 1</command>

	<jobname><cyclestr>&PSLOT;_firstcyc_@H</cyclestr></jobname>
	<account>&ACCOUNT;</account>
	<queue>&QUEUE;</queue>
	<partition>&PARTITION_SERVICE;</partition>
	&RESOURCES_ARCH_GDAS;
	<walltime>&WALLTIME_ARCH_GDAS;</walltime>
	<native>&NATIVE_ARCH_GDAS;</native>

	<join><cyclestr>&ROTDIR;/logs/@Y@m@d@H/firstcyc.log</cyclestr></join>

	<dependency>
		<and>
			<datadep><cyclestr offset="24:00:00">&EXPDIR;/logs/@Y@m@d@H.log</cyclestr></datadep>
			<not><cycleexistdep cycle_offset="-06:00:00"/></not>
		</and>
	</dependency>

</task>

</workflow>
